meta:
  version: 3
  flow: Chip
  substituting_steps:

    # Disable KLayout DRC
    #KLayout.DRC: null
    #Checker.KLayoutDRC: null

    # Disable KLayout antenna check
    KLayout.Antenna: null
    Checker.KLayoutAntenna: null

    # Disable KLayout density check
    #KLayout.Density: null
    #Checker.KLayoutDensity: null

    # Save time during development
    # Enable for sign-off
    #OpenROAD.IRDropReport: null
    #Magic.DRC: null
    #Checker.MagicDRC: null
    #KLayout.XOR: null
    #Netgen.LVS: null
    #Checker.LVS: null

# Don't delete these, however tempting. It is NOT sufficient to just create
# clocks in the .sdc. LibreLane COMPLETELY SKIPS CTS if the magic yaml flags
# are not present, and your clock ends up totally unbuffered.
CLOCK_PORT: pad_CLK
CLOCK_NET: pad_CLK/Y
CLOCK_PERIOD: 20 # ns

PNR_SDC_FILE: dir::chip_top.sdc
SIGNOFF_SDC_FILE: dir::chip_top.sdc
FALLBACK_SDC: dir::chip_top.sdc

###############################################################################
# QoR

STD_CELL_LIBRARY: gf180mcu_fd_sc_mcu9t5v0

# Force use of chonky bois to reduce clock skew (default list is 2, 4, 8). d20
# is 9-track only I think
CTS_CLK_BUFFERS:
  - "gf180mcu_fd_sc_mcu9t5v0__clkbuf_8"
  - "gf180mcu_fd_sc_mcu9t5v0__clkbuf_16"
  - "gf180mcu_fd_sc_mcu9t5v0__clkbuf_20"

# Doesn't seem to achieve much but the docs imply this should be set if you
# have CG cells on your clock tree (or any cells inserted prior to CTS)
CTS_BALANCE_LEVELS: True

# Magic, thank you Lofty
SYNTH_STRATEGY: "AREA 3"

# Why is this not the default???
# abc cmd: upsize {D};dnsize {D}
SYNTH_SIZING: True
# Takes precedence over previous
# abc cmd: f"buffer -N {self.max_fanout}{max_tr_arg};upsize {{D}};dnsize {{D}}"
# (where self.max_fanout comes from config["MAX_FANOUT_CONSTRAINT"])
SYNTH_ABC_BUFFERING: True
# Strip out buffers inserted by ABC and re-buffer after global placement. The
# synthesis buffers are just there to get a better guess for GPL.
DESIGN_REPAIR_REMOVE_BUFFERS: True

# default: 10
MAX_FANOUT_CONSTRAINT: 5
# MAX_TRANSITION_CONSTRAINT: 1

# Substitute missing flop types for strapped scan flops
SYNTH_EXTRA_MAPPING_FILE: dir::/gf180_scanflop_map.v

# ICG inference; the CTS still inexplicably puts a clock root after each gate
# but this doesn't affect the skew too much for the small gate groups inferred
# by this pass (unlike explicit top-level ICGs which are catastrophic). Clock
# skew is a little worse but we get better DFFE mapping.
# -> Disabled to reduce clock skew (since DFFEs are now a thing via scan flops)
# USE_LIGHTER: True

PL_TARGET_DENSITY_PCT: 50
GRT_ALLOW_CONGESTION: true

# Magic incantation from Discord to make the antenna violations go away
DRT_ANTENNA_REPAIR_ITERS: 10

# Try to avoid occasional hold failures on short paths into SRAM address.
# Original: PL 0.1 GRT 0.05
PL_RESIZER_HOLD_SLACK_MARGIN: 0.21
GRT_RESIZER_HOLD_SLACK_MARGIN: 0.16

# Apply insane levels of slack margin because I keep seeing a bunch of drive-1
# cells on my critical paths, just do your job dude
# Default: 0.05
PL_RESIZER_SETUP_SLACK_MARGIN: 3
# Default: 0.025
GRT_RESIZER_SETUP_SLACK_MARGIN: 3

# Cmon do something
PL_RESIZER_FIX_HOLD_FIRST: True
GRT_RESIZER_FIX_HOLD_FIRST: True
PL_RESIZER_SETUP_MAX_BUFFER_PCT: 100
GRT_RESIZER_SETUP_MAX_BUFFER_PCT: 100

# Second pass through the resizer (so CTS -> resize -> GRT -> resize) seems to
# give a bit of oomph. I imagine part of this is just because we do hold fix,
# then setup fix, then hold fix again, then setup fix again
RUN_POST_GRT_RESIZER_TIMING: True

# Slew margin seems to be the key to getting some size-ups done before
# detailed placement
# default 20:
DESIGN_REPAIR_MAX_SLEW_PCT: 80 # <- this guy right here
# default 20:
DESIGN_REPAIR_MAX_CAP_PCT: 50

# If you're reading this far and you think "this idiot is just trying every
# option to see if it improves timing" then you're right

# Saw some multi-millimetre-long wires on the clock branch going to the SRAMs
# (which branches from the very first clock buffer) so try to limit that. Unit
# is um, default is 0 meaning no limit.

# Disabled because it creates insane skew: seems to be done as a post-CTS
# repair step, not as part of CTS.
# CTS_CLK_MAX_WIRE_LENGTH: 500

# This one is actually used during CTS (though curiously it's just documented
# as "distance" not max distance) -> don't use, it also stops the normal CTS
# algorithm from being run.
# CTS_DISTANCE_BETWEEN_BUFFERS: 500


###############################################################################
# Files

DESIGN_NAME: chip_top
VERILOG_FILES:
- dir::../hdl/chip_top.sv
- dir::../hdl/chip_core.sv

- dir::../hdl/apu/audio_processor.v
- dir::../hdl/apu/ipc/apu_ipc.v
- dir::../hdl/apu/ipc/apu_ipc_regs.v
- dir::../hdl/apu/aout/apu_aout.v
- dir::../hdl/apu/aout/apu_aout_regs.v
- dir::../hdl/apu/aout/apu_lowpass_filter.v
- dir::../hdl/apu/aout/apu_sdm.v
- dir::../hdl/apu/timer/apu_timer.v
- dir::../hdl/apu/timer/apu_timer_regs.v

- dir::../hdl/clocks/clocks.v
- dir::../hdl/clocks/clocks_regs.v

- dir::../hdl/vuart/vuart.v
- dir::../hdl/vuart/vuart_host_regs.v
- dir::../hdl/vuart/vuart_dev_regs.v

- dir::../hdl/spi_stream/spi_stream.v
- dir::../hdl/spi_stream/spi_stream_regs.v

- dir::../hdl/uart/uart_mini.v
- dir::../hdl/uart/uart_regs.v

- dir::../hdl/mem/ahb_sync_sram.v
- dir::../hdl/mem/sram_wrapper.v
- dir::../hdl/mem/ahb_rom_boot.v

- dir::../hdl/padctrl/padctrl.v
- dir::../hdl/padctrl/padctrl_regs.v

- dir::../hdl/gpio/gpio.v
- dir::../hdl/gpio/gpio_regs.v

- dir::../hdl/hazard3/hdl/hazard3_cpu_1port.v
- dir::../hdl/hazard3/hdl/arith/hazard3_alu.v
- dir::../hdl/hazard3/hdl/arith/hazard3_branchcmp.v
- dir::../hdl/hazard3/hdl/arith/hazard3_mul_fast.v
- dir::../hdl/hazard3/hdl/arith/hazard3_muldiv_seq.v
- dir::../hdl/hazard3/hdl/arith/hazard3_onehot_encode.v
- dir::../hdl/hazard3/hdl/arith/hazard3_onehot_priority.v
- dir::../hdl/hazard3/hdl/arith/hazard3_onehot_priority_dynamic.v
- dir::../hdl/hazard3/hdl/arith/hazard3_priority_encode.v
- dir::../hdl/hazard3/hdl/arith/hazard3_shift_barrel.v
- dir::../hdl/hazard3/hdl/debug/cdc/hazard3_apb_async_bridge.v
- dir::../hdl/hazard3/hdl/debug/cdc/hazard3_reset_sync.v
- dir::../hdl/hazard3/hdl/debug/cdc/hazard3_sync_1bit.v
- dir::../hdl/hazard3/hdl/debug/dm/hazard3_dm.v
- dir::../hdl/hazard3/hdl/debug/dtm/hazard3_jtag_dtm.v
- dir::../hdl/hazard3/hdl/debug/dtm/hazard3_jtag_dtm_core.v
- dir::../hdl/hazard3/hdl/hazard3_core.v
- dir::../hdl/hazard3/hdl/hazard3_csr.v
- dir::../hdl/hazard3/hdl/hazard3_decode.v
- dir::../hdl/hazard3/hdl/hazard3_frontend.v
- dir::../hdl/hazard3/hdl/hazard3_instr_decompress.v
- dir::../hdl/hazard3/hdl/hazard3_irq_ctrl.v
- dir::../hdl/hazard3/hdl/hazard3_pmp.v
- dir::../hdl/hazard3/hdl/hazard3_power_ctrl.v
- dir::../hdl/hazard3/hdl/hazard3_regfile_1w2r.v
- dir::../hdl/hazard3/hdl/hazard3_triggers.v

- dir::../hdl/hazard3/example_soc/soc/peri/hazard3_riscv_timer.v

- dir::../hdl/libfpga/common/onehot_mux.v
- dir::../hdl/libfpga/common/onehot_priority.v
- dir::../hdl/libfpga/common/onehot_encoder.v
- dir::../hdl/libfpga/common/sync_fifo.v
- dir::../hdl/libfpga/common/clkdiv_frac.v
- dir::../hdl/libfpga/cdc/sync_1bit.v
- dir::../hdl/libfpga/cdc/async_fifo.v
- dir::../hdl/libfpga/cdc/gray_counter.v
- dir::../hdl/libfpga/cdc/gray_decode.v
- dir::../hdl/libfpga/busfabric/ahbl_to_apb.v
- dir::../hdl/libfpga/busfabric/ahbl_splitter.v
- dir::../hdl/libfpga/busfabric/apb_splitter.v
- dir::../hdl/libfpga/mem/sram_sync_1r1w.v

- dir::../hdl/cells/clkroot_anchor.v
- dir::../hdl/cells/falsepath_anchor.v
- dir::../hdl/cells/cell_clkdiv_3over2.v
- dir::../hdl/cells/cell_clkgate_low.v
- dir::../hdl/cells/cell_clkmux_glitchless.v
- dir::../hdl/cells/cell_clkxor.v
- dir::../hdl/cells/cell_ddr_out.v
- dir::../hdl/cells/reset_sync.v
- dir::../hdl/cells/async_sram_phy_gf180mcu.v

- dir::../hdl/twowiredebug/hdl/twowire_dtm_core.v
- dir::../hdl/twowiredebug/hdl/twowire_dtm_serial_comms.v
- dir::../hdl/twowiredebug/hdl/cells/twowire_dtm_io_flops.v
- dir::../hdl/twowiredebug/hdl/twowire_dtm_connect_monitor.v
- dir::../hdl/twowiredebug/hdl/twowire_dtm.v

- dir::../hdl/riscboy/hdl/sram_ctrl/riscboy_sram_ctrl.v

- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_cproc_frontend.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_palette_mapper.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_blender.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_ahbl_adapter.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_tile_agu.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_affine_coord_gen.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu.v
- dir::../hdl/riscboy/hdl/graphics/ppu/regs/ppu_regs.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_phase_accum.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_pixel_agu.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_bus_arbiter.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_shift_unshift.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_pixel_unpack.v
- dir::../hdl/riscboy/hdl/graphics/ppu/riscboy_ppu_cproc.v
- dir::../hdl/riscboy/hdl/peris/pwm_tiny/pwm_tiny.v
- dir::../hdl/riscboy/hdl/peris/pwm_tiny/pwm_tiny_regs.v

- dir::../hdl/dispctrl/riscboy_ppu_dispctrl_rb180.v
- dir::../hdl/dispctrl/regs/ppu_dispctrl_rb180_regs.v

VERILOG_INCLUDE_DIRS:
- dir::../hdl/hazard3/hdl
- dir::../hdl/riscboy/hdl/graphics/ppu

VERILOG_DEFINES:
- NOCLOCKGATES
- GF180MCU
- USE_POWER_PINS

# Slightly smaller file sizes
PRIMARY_GDSII_STREAMOUT_TOOL: klayout

###############################################################################
# Padring

# To remain bond-compatible with the template project, the DVDD and DVSS pads
# must remain in the same positions (as commented below). The different IO pad
# macros are all the same size, so these can be freely mixed and matched as
# long as the totals are the same.

# SRAM pads are ordered to wire out symmetrically to a 44-pin 16-bit SRAM
# (e.g. R1RP0416DI) in a broadside orientation.

# Note our SRAM A and DQ are *both* numbered from 0, which is different from
# some datasheets.

# My pad numbering is starting from 0 at northwest corner (on west edge) and
# going anticlockwise.

# Pads 19 through  0
PAD_WEST: [
    "dvdd_pads\\[7\\].pad", # FIXED 19
    "dvss_pads\\[9\\].pad", # FIXED 18
    "dvdd_pads\\[6\\].pad", # FIXED 17
    "dvss_pads\\[8\\].pad", # FIXED 16

    # 6 IOs (15 through 10):
    "pad_LCD_DAT\\[3\\].u",
    "pad_LCD_DAT\\[2\\].u",
    "pad_LCD_DAT\\[1\\].u",
    "pad_LCD_DAT\\[0\\].u",
    "pad_LCD_CLK",
    "pad_LCD_DC",

    "dvdd_pads\\[5\\].pad", # FIXED 9
    "dvss_pads\\[7\\].pad", # FIXED 8

    # 4 IOs (7 through 4):
    "pad_LCD_BL",
    "pad_CLK",
    "pad_RSTn",
    "pad_AUDIO",

    "dvdd_pads\\[4\\].pad", # FIXED 3
    "dvss_pads\\[6\\].pad", # FIXED 2

    # 2 IOs (1 through 0):
    "pad_DIO",
    "pad_DCK",
]

# Pads 20 through 36
PAD_SOUTH: [
    # 8 IOs (20 through 27):
    "pad_LCD_DAT\\[4\\].u",
    "pad_LCD_DAT\\[5\\].u",
    "pad_LCD_DAT\\[6\\].u",
    "pad_LCD_DAT\\[7\\].u",
    "pad_GPIO\\[0\\].u",
    "pad_GPIO\\[1\\].u",
    "pad_GPIO\\[2\\].u",
    "pad_GPIO\\[3\\].u",

    "dvss_pads\\[0\\].pad", # FIXED 28

    # 8 IOs (29 through 36):
    "pad_SRAM_DQ\\[11\\].u",
    "pad_SRAM_DQ\\[10\\].u",
    "pad_SRAM_DQ\\[9\\].u",
    "pad_SRAM_DQ\\[8\\].u",
    "pad_SRAM_A\\[14\\].u",
    "pad_SRAM_A\\[13\\].u",
    "pad_SRAM_A\\[12\\].u",
    "pad_SRAM_A\\[11\\].u",
]

# Pads 37 through 56
PAD_EAST: [
    "dvdd_pads\\[0\\].pad", # FIXED 37
    "dvss_pads\\[1\\].pad", # FIXED 38

    # 6 IOs (39 through 44));
    "pad_SRAM_A\\[10\\].u",
    "pad_SRAM_A\\[9\\].u",
    "pad_SRAM_A\\[8\\].u",
    "pad_SRAM_A\\[7\\].u",
    "pad_SRAM_A\\[6\\].u",
    "pad_SRAM_A\\[5\\].u",

    "dvdd_pads\\[1\\].pad", # FIXED 45
    "dvss_pads\\[2\\].pad", # FIXED 46

    # 6 IOs (47 through 52):
    "pad_SRAM_WEn",
    "pad_SRAM_DQ\\[7\\].u",
    "pad_SRAM_DQ\\[6\\].u",
    "pad_SRAM_DQ\\[5\\].u",
    "pad_SRAM_DQ\\[4\\].u",
    "pad_SRAM_DQ\\[3\\].u",

    "dvss_pads\\[3\\].pad", # FIXED 53
    "dvdd_pads\\[2\\].pad", # FIXED 54
    "dvss_pads\\[4\\].pad", # FIXED 55
    "dvdd_pads\\[3\\].pad", # FIXED 56
]

# Pads 73 through 57
PAD_NORTH: [
    # 8 IOs: 73 through 66
    "pad_SRAM_DQ\\[12\\].u",
    "pad_SRAM_DQ\\[13\\].u",
    "pad_SRAM_DQ\\[14\\].u",
    "pad_SRAM_DQ\\[15\\].u",
    "pad_SRAM_OEn",
    "pad_SRAM_A\\[15\\].u",
    "pad_SRAM_A\\[16\\].u",
    "pad_SRAM_A\\[0\\].u",

    "dvss_pads\\[5\\].pad", # FIXED 65

    # 8 IOs: 65 through 57
    "pad_SRAM_A\\[1\\].u",
    "pad_SRAM_A\\[2\\].u",
    "pad_SRAM_A\\[3\\].u",
    "pad_SRAM_A\\[4\\].u",
    "pad_SRAM_CSn",
    "pad_SRAM_DQ\\[2\\].u",
    "pad_SRAM_DQ\\[1\\].u",
    "pad_SRAM_DQ\\[0\\].u",
]

###############################################################################
# Layout stuff

# Power / ground nets
VDD_NETS:
- VDD
GND_NETS:
- VSS

# We need to add gf180mcu_fd_io__bi_24t
# due to the unused Y output for output only pads
IGNORE_DISCONNECTED_MODULES:
- gf180mcu_fd_io__bi_24t
- gf180mcu_fd_io__bi_t
- gf180mcu_ws_ip__id
- gf180mcu_ws_ip__logo

# Floorplanning
FP_SIZING: absolute
# 3880umx5070um including 26um
# for the sealring on all sides
DIE_AREA: [0, 0, 3932, 5122]
CORE_AREA: [442, 442, 3490, 4680]

# PDN - Straps
PDN_VWIDTH: 5
PDN_HWIDTH: 5
PDN_VSPACING: 1
PDN_HSPACING: 1
PDN_VPITCH: 75
PDN_HPITCH: 75

# PDN - Core ring
PDN_CORE_RING: True
# Maximum metal width without slotting: 30um
PDN_CORE_RING_VWIDTH: 25
PDN_CORE_RING_HWIDTH: 25
PDN_CORE_RING_CONNECT_TO_PADS: True
PDN_ENABLE_PINS: False
PDN_CORE_VERTICAL_LAYER: Metal2
PDN_CORE_HORIZONTAL_LAYER: Metal3

# Due to OpenROAD bug
# https://github.com/The-OpenROAD-Project/OpenROAD/issues/8229
#PL_TIME_DRIVEN: False
#PL_ROUTABILITY_DRIVEN: False

# Prevent false positive DRC errors in I/O cells
MAGIC_GDS_FLATGLOB:
# For contacts
- "*_CDNS_*"
# COMP and Poly2 filler cells need to be
# flattened to form a "filltrans" layer
- "COMP_fill_cell"
- "Poly2_fill_cell"
# Foundry provided SRAMs
- "*$$*"
- "M1_N*"
- "M1_P*"
- "M2_M1*"
- "M3_M2*"
- "nmos_5p0*"
- "nmos_1p2*"
- "pmos_5p0*"
- "pmos_1p2*"
- "via1_*"
- "ypass_gate*"
- "G_ring_*"
# These additional cells must be flattened to get rid of 3.3V devices
# (DUALGATE drawn into high-level cells)
- "dcap_103*"
- "din_*"
- "mux821_*"
- "rdummy_*"
- "pmoscap_*"
- "xdec_*"
- "ypredec*"
- "xpredec*"
- "xdec8_*"
- "prexdec_*"
- "xdec32_*"
- "sa_*"

# Because we have multiple power pads for one power domain
MAGIC_EXT_UNIQUE: notopports

MACROS:
  gf180mcu_ws_ip__id:
    gds:
      - dir::../ip/gf180mcu_ws_ip__id/gds/gf180mcu_ws_ip__id.gds
    lef:
      - dir::../ip/gf180mcu_ws_ip__id/lef/gf180mcu_ws_ip__id.lef
    vh:
      - dir::../ip/gf180mcu_ws_ip__id/vh/gf180mcu_ws_ip__id.v
    lib:
      "*":
        - dir::../ip/gf180mcu_ws_ip__id/lib/gf180mcu_ws_ip__id.lib
    instances:
      chip_id:
        location: [26, 26]
        orientation: N

  gf180mcu_ws_ip__logo:
    gds:
      - dir::../ip/gf180mcu_ws_ip__logo/gds/gf180mcu_ws_ip__logo.gds
    lef:
      - dir::../ip/gf180mcu_ws_ip__logo/lef/gf180mcu_ws_ip__logo.lef
    vh:
      - dir::../ip/gf180mcu_ws_ip__logo/vh/gf180mcu_ws_ip__logo.v
    lib:
      "*":
        - dir::../ip/gf180mcu_ws_ip__logo/lib/gf180mcu_ws_ip__logo.lib
    instances:
      wafer_space_logo:
        location: [3762.75, 4952.75]
        orientation: N

  gf180mcu_fd_ip_sram__sram128x8m8wm1:
    gds:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/gds/gf180mcu_fd_ip_sram__sram128x8m8wm1.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lef/gf180mcu_fd_ip_sram__sram128x8m8wm1.lef
    vh:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/verilog/gf180mcu_fd_ip_sram__sram128x8m8wm1__blackbox.v
    lib:
      "*_tt_025C_5v00":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram128x8m8wm1__tt_025C_5v00.lib
      "*_ff_n40C_5v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram128x8m8wm1__ff_n40C_5v50.lib
      "*_ss_125C_4v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram128x8m8wm1__ss_125C_4v50.lib

  gf180mcu_fd_ip_sram__sram256x8m8wm1:
    gds:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/gds/gf180mcu_fd_ip_sram__sram256x8m8wm1.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lef/gf180mcu_fd_ip_sram__sram256x8m8wm1.lef
    vh:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/verilog/gf180mcu_fd_ip_sram__sram256x8m8wm1__blackbox.v
    lib:
      "*_tt_025C_5v00":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram256x8m8wm1__tt_025C_5v00.lib
      "*_ff_n40C_5v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram256x8m8wm1__ff_n40C_5v50.lib
      "*_ss_125C_4v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram256x8m8wm1__ss_125C_4v50.lib
    instances:
      i_chip_core.ppu_u.blender.palette_mapper.pram_u.g_d256.g_width[0].ram_u:
        location: [500, 3125]
        orientation: "N"
      i_chip_core.ppu_u.blender.palette_mapper.pram_u.g_d256.g_width[1].ram_u:
        location: [1000, 3125]
        orientation: "N"

  gf180mcu_fd_ip_sram__sram512x8m8wm1:
    gds:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/gds/gf180mcu_fd_ip_sram__sram512x8m8wm1.gds
    lef:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lef/gf180mcu_fd_ip_sram__sram512x8m8wm1.lef
    vh:
      - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/verilog/gf180mcu_fd_ip_sram__sram512x8m8wm1__blackbox.v
    lib:
      "*_tt_025C_5v00":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram512x8m8wm1__tt_025C_5v00.lib
      "*_ff_n40C_5v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram512x8m8wm1__ff_n40C_5v50.lib
      "*_ss_125C_4v50":
        - pdk_dir::libs.ref/gf180mcu_fd_ip_sram/lib/gf180mcu_fd_ip_sram__sram512x8m8wm1__ss_125C_4v50.lib
    instances:
      # Make sure to specify the SRAMs in pdn_cfg.tcl
      i_chip_core.iram_u.sram.g_dg512.g_depth[0].g_width[0].ram_u:
        location: [3000, 500]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[0].g_width[1].ram_u:
        location: [3000, 1025]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[0].g_width[2].ram_u:
        location: [3000, 1550]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[0].g_width[3].ram_u:
        location: [3000, 2075]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[1].g_width[0].ram_u:
        location: [2500, 500]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[1].g_width[1].ram_u:
        location: [2500, 1025]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[1].g_width[2].ram_u:
        location: [2500, 1550]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[1].g_width[3].ram_u:
        location: [2500, 2075]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[2].g_width[0].ram_u:
        location: [1000, 500]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[2].g_width[1].ram_u:
        location: [1000, 1025]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[2].g_width[2].ram_u:
        location: [1000, 1550]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[2].g_width[3].ram_u:
        location: [1000, 2075]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[3].g_width[0].ram_u:
        location: [500, 500]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[3].g_width[1].ram_u:
        location: [500, 1025]
        orientation: "S"
      i_chip_core.iram_u.sram.g_dg512.g_depth[3].g_width[2].ram_u:
        location: [500, 1550]
        orientation: "N"
      i_chip_core.iram_u.sram.g_dg512.g_depth[3].g_width[3].ram_u:
        location: [500, 2075]
        orientation: "N"

      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[0].g_width[0].ram_u:
        location: [2500, 3650]
        orientation: "S"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[0].g_width[1].ram_u:
        location: [2500, 4175]
        orientation: "N"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[0].g_width[2].ram_u:
        location: [3000, 3650]
        orientation: "S"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[0].g_width[3].ram_u:
        location: [3000, 4175]
        orientation: "N"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[1].g_width[0].ram_u:
        location: [2500, 2600]
        orientation: "S"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[1].g_width[1].ram_u:
        location: [2500, 3125]
        orientation: "N"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[1].g_width[2].ram_u:
        location: [3000, 2600]
        orientation: "S"
      i_chip_core.apu_u.ram_u.sram.g_dg512.g_depth[1].g_width[3].ram_u:
        location: [3000, 3125]
        orientation: "N"



      i_chip_core.ppu_u.scanbuf0_u.g_d512.g_width[0].ram_u:
        location: [500, 3650]
        orientation: "S"
      i_chip_core.ppu_u.scanbuf0_u.g_d512.g_width[1].ram_u:
        location: [500, 4175]
        orientation: "N"
      i_chip_core.ppu_u.scanbuf1_u.g_d512.g_width[0].ram_u:
        location: [1000, 3650]
        orientation: "S"
      i_chip_core.ppu_u.scanbuf1_u.g_d512.g_width[1].ram_u:
        location: [1000, 4175]
        orientation: "N"

PDN_CFG: dir::pdn_cfg.tcl

# Halo size around macros while cutting rows.
# Workaround for: https://github.com/The-OpenROAD-Project/OpenROAD/issues/8868
# FP_MACRO_HORIZONTAL_HALO: 10
# FP_MACRO_VERTICAL_HALO: 10
# FP_PDN_HORIZONTAL_HALO: 5
# FP_PDN_VERTICAL_HALO: 5

# Above seems like overkill
PDN_VERTICAL_HALO: 1
PDN_HORIZONTAL_HALO: 1

# Make sure netgen doesn't create 'no_connect' nets
# Not needed since netgen 1.5.303
LVS_FLATTEN_CELLS:
- gf180mcu_ws_ip__id
- gf180mcu_ws_ip__logo

# gf180mcu_ws_ip__id/logo has no ports and components
# therefore make it an abstract cell in the layout
MAGIC_EXT_ABSTRACT_CELLS:
- gf180mcu_ws_ip__id
- gf180mcu_ws_ip__logo
